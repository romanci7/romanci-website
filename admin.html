<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROMANCI Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #111, #222);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}
#login, #admin-panel {
  background: rgba(0,0,0,0.85);
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(255,215,0,0.4);
  width: 400px;
  text-align: center;
  transition: all 0.4s ease;
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  border: none;
  font-size: 1rem;
}
button {
  background: linear-gradient(90deg,#fdd835,#fbc02d);
  color: #111;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover { filter: brightness(1.2); }
#admin-panel { display: none; }
table { width: 100%; margin-top: 10px; border-collapse: collapse; }
th, td { padding: 6px; border: 1px solid #555; text-align: left; }
th { background: #333; }
.action-btn { width: auto; margin-right: 5px; padding: 4px 8px; border-radius: 6px; }
.approve { background: #4caf50; color:#fff; }
.reject { background: #f44336; color:#fff; }
</style>
</head>
<body>

<div id="login">
  <h2>ROMANCI Admin Login</h2>
  <button id="loginBtn">Login with Google</button>
</div>

<div id="admin-panel">
  <h2>Admin Panel</h2>
  <p>Welcome, <span id="userName"></span></p>
  <button id="logoutBtn">Logout</button>

  <h3>Pending Vouches</h3>
  <table>
    <thead>
      <tr><th>Name</th><th>Message</th><th>Approved</th><th>Actions</th></tr>
    </thead>
    <tbody id="vouchList"></tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
   apiKey: "AIzaSyCT1_NEA_UIu_1dSTgy5awbGQI-7KCywVo",
   authDomain: "romanci-vouch.firebaseapp.com",
   projectId: "romanci-vouch",
   storageBucket: "romanci-vouch.firebasestorage.app",
   messagingSenderId: "154787033593",
   appId: "1:154787033593:web:0855c02f6c1d7204ed8d28",
   measurementId: "G-7QWKQ6ZXX3"
 };

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// DOM elements
const loginDiv = document.getElementById("login");
const adminDiv = document.getElementById("admin-panel");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userNameSpan = document.getElementById("userName");
const vouchList = document.getElementById("vouchList");

// --- LOGIN ---
loginBtn.addEventListener("click", () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

// --- LOGOUT ---
logoutBtn.addEventListener("click", () => {
  auth.signOut();
});

// --- AUTH STATE ---
auth.onAuthStateChanged(user => {
  if(user){
    loginDiv.style.display = "none";
    adminDiv.style.display = "block";
    userNameSpan.textContent = user.displayName || user.email;

    // Load pending vouches
    db.collection("vouches")
      .orderBy("timestamp","desc")
      .onSnapshot(snapshot => {
        vouchList.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${data.name}</td>
            <td>${data.message}</td>
            <td>${data.approved ? "✅" : "❌"}</td>
            <td>
              <button class="action-btn approve" onclick="approveVouch('${doc.id}')">Approve</button>
              <button class="action-btn reject" onclick="rejectVouch('${doc.id}')">Reject</button>
            </td>
          `;
          vouchList.appendChild(tr);
        });
      });
  } else {
    loginDiv.style.display = "block";
    adminDiv.style.display = "none";
  }
});

// --- APPROVE / REJECT FUNCTIONS ---
window.approveVouch = async (id) => {
  await db.collection("vouches").doc(id).update({ approved: true });
};

window.rejectVouch = async (id) => {
  await db.collection("vouches").doc(id).update({ approved: false, rejected: true });
};
</script>
</body>
</html>
